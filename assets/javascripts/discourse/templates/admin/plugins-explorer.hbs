<h2>Queries</h2>

{{#if not_https}}
  <div class="https-warning">
    {{fa-icon "warning"}}
    {{i18n "explorer.https_warning"}}
  </div>
{{/if}}

<div class="query-list">
  {{combo-box valueAttribute="id" value=selectedQueryId nameProperty="listName" content=content castInteger="true" nameChanges="true"}}
  {{d-button action="showCreate" icon="plus" class="no-text"}}
  {{d-button action="importQuery" label="explorer.import.label" icon="upload"}}
</div>

{{#if showCreate}}
  <div class="query-create">
    {{text-field value=newQueryName placeholderKey="explorer.create_placeholder"}}
    {{d-button action="create" label="explorer.create" icon="plus" class="btn-primary"}}
  </div>
{{/if}}

<hr>

{{#if selectedItem.fake}}
  {{i18n "explorer.no_queries"}} <a {{action "showCreate"}}>{{i18n "explorer.no_queries_hook"}}</a>
{{else}}
  <div class="query-edit {{if editName "editing"}}">
    {{#if selectedItem}}
      <div class="name">
        {{#if editing}}
          {{text-field value=selectedItem.name}}
        {{else}}
          <h2>{{selectedItem.name}}</h2>
          {{d-button action="editName" icon="pencil" class="no-text btn-small"}}
        {{/if}}
      </div>
      <div class="desc">
        {{#if editing}}
          {{textarea value=selectedItem.description}}
        {{else}}
          {{selectedItem.description}}
        {{/if}}
      </div>


      <div class="query-editor">
        <div class="right-panel">
          <div class="schema grippie-target">
            {{explorer-schema schema=schema}}
          </div>
        </div>
        <div class="editor-panel">
          {{ace-editor content=selectedItem.sql mode="sql"}}
        </div>
        <div class="grippie"></div>
        <div class="clear"></div>
      </div>

      <div class="clear"></div>
      <div class="pull-left">
        {{d-button action="save" label="explorer.save" disabled=saveDisabled class="btn-primary"}}
        {{d-button action="download" label="explorer.export" disabled=runDisabled icon="download"}}
      </div>
      <div class="pull-right">
        {{#if selectedItem.destroyed}}
          {{d-button action="recover" class="" icon="undo" label="explorer.recover"}}
        {{else}}
          {{d-button action="discard" class="btn-danger" icon="undo" label="explorer.undo" disabled=saveDisabled}}
          {{d-button action="destroy" class="btn-danger" icon="trash" label="explorer.delete"}}
        {{/if}}
      </div>
      <div class="clear"></div>
    {{/if}}
  </div>

  <form class="query-run" {{action "run" on="submit"}}>
    {{#if selectedItem.param_names}}
      <div class="query-params">
        <div class="param-save">
          {{d-button action="saveDefaults" label="explorer.save_params" type="button"}}
          {{d-button action="resetParams" label="explorer.reset_params" type="button"}}
        </div>
        {{#each selectedItem.param_names as |pname|}}
          <div class="param">
            {{param-field params=selectedItem.params pname=pname}}
            <span class="param-name">{{pname}}</span>
          </div>
        {{/each}}
      </div>
    {{/if}}
    <div class="bool-options">
      <label>{{input type="checkbox" checked=explain name="explain"}} {{i18n "explorer.explain_label"}}</label>
    </div>
    {{#if runDisabled}}
      {{#if saveDisabled}}
        {{d-button label="explorer.run" disabled="true" class="btn-primary"}}
      {{else}}
        {{d-button action="saverun" label="explorer.saverun"}}
      {{/if}}
    {{else}}
      {{d-button action="run" label="explorer.run" disabled=runDisabled class="btn-primary" type="submit"}}
    {{/if}}
  </form>

  <hr>
{{/if}}
{{conditional-loading-spinner condition=loading}}
{{#unless selectedItem.fake}}
  {{#if results}}
    <div class="query-results">
      {{#if showResults}}
        {{query-result query=selectedItem content=results}}
      {{else}}
        {{#each results.errors as |err|}}
          <pre class="query-error"><code>{{~err}}</code></pre>
        {{/each}}
      {{/if}}
    </div>
  {{/if}}
{{/unless}}

<div class="explorer-pad-bottom"></div>
